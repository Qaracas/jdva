#!/usr/bin/gawk -E

@include "../src/ecma-404.awk"

BEGIN {
    cad_json01[0] = "";
    cad_json02[0] = "";
    json01 = "";
    json02 = "";

    while ((getline linea < ARGV[1]) > 0)
        cad_json01[0] = cad_json01[0] linea;
    close(ARGV[1]);
    
    json01 = cad_json01[0];
    
    printf("%s", "Convertir JSON 01 en lista 01... ");
    jsonLstm(cad_json01, lista01);
    print "Hecho.";

    printf("%s", "Convertir lista 01 en JSON 02... ");
    lstmJson(lista01, cad_json02);
    print "Hecho.";
    
    json02 = cad_json02[0];
    
    printf("%s", "Convertir JSON 02 en lista 02... ");
    jsonLstm(cad_json02, lista02);
    print "Hecho.";
    
    print json02; exit 0;

#    pinta_elmtos(lista01); 
#    print;
#    pinta_elmtos(lista02);
#    exit 0;
    
    for (i in lista01) {
        for (j in lista01[i]) {
            for (k in lista01[i][j]) {
                if (!(i in lista02)) {
                    printf "Error: No existe registro %s en resultado.", i;  
                    exit -1;
                }
                if (!(j in lista02[i])) {
                    printf "Error: No existe elemento %s en registro %s.", j, i;  
                    exit -1;
                }
                if (!(k in lista02[i][j])) {
                    printf "Error: No existe componente %s en elemento %s.", k, j;  
                    exit -1;
                }
                printf("Compara elemento %s de lista 01 y 02... ", i);
                if (lista01[i][j][k] != lista02[i][j][k]) {
                    print "Error.";
                    exit -1; 
                }
                print "Hecho.";
            }
        }
    }
    print "Â¡Bien! Prueba superada."
    exit 0;
}
